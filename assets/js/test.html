
<!DOCTYPE html>
<html>
  <head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
<script src="geolocation.js"></script>
<script src="findPlaces.js"></script>
<script src="cartesianProduct.js"></script>
<script src="optimizeRoute.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYoGQjMzQNVUCupkIb99CiXB_Qo_CQZYY"></script>

<script>
  var chickfilas;
  var chipotles;
  var candidateChickpotles;
  var chickpotle;
  var test;


// Setup promise chain so that asynchronous calls complete before the next step
// Try to geolocate user
  findUserLocation.then()
    // Redirect user to manualAddress.html
    // ****HOW DOES THIS WORK WITH RESOLVE --> WE WANT TO WAIT UNTIL EITHER RESOLVE OR CATCH EXECUTES BEFORE MOVING TO NEXT STEP
    // Deal with later
    .catch(function() {
  }).then(function() {
    // Gather names and IDs for all nearby Chick-fil-A and Chipotle restaurants
    return Promise.all([
      gatherNearbyGooglePlacesFor("Chick-fil-A"),
      gatherNearbyGooglePlacesFor("Chipotle Mexican Grill")
    ])
  }).then(function(results) {
    // Wait until both promises are fulfilled and then assign the place IDs
    // to the appropriate variables
    chickfilas = results[0];
    chipotles = results[1];
  }).then(function() {
    // Use the place IDs to query on the addresses; update chickfilas and
    // chipotles objects with appropriate properties
    // Create gate on both JSON requests
    return Promise.all([
      getAddressesFor(chickfilas),
      getAddressesFor(chipotles)
    ])
  }).then(function(results) {
    // After gate opens, update chickfilas and chipotles with the latest array
    chickfilas = results[0];
    chipotles = results[1];
  }).then(function(results) {
    // Combine chickfilas and chipotles objects into every possible unique
    // combination, where order does not matter
    // Assign results to new candidateChickpotles object and place in array
    candidateChickpotles = cartesianProductOf(chickfilas,chipotles);
  }).then(function() {
    // Pass candidateChickpotles objects back to google for directionsService
    // API query
    return reportTravelTimes(candidateChickpotles);
  }).then(function(results) {
    // Update candidatesChickpotles objects with duration (of trip) property
    // in seconds
    console.log("Results are in");
    candidateChickpotles = results;
  }).then(function() {
    // Send candidatesChickpotle object array (with duration property) to
    // method that analyzes each object and selects the object with the lowest
    // duration
    return selectOptimalChickpotle(candidateChickpotles);
  }).then(function(results) {
    // Assigns the winning object to the chickpotle variable
    //available properties are: addresses, IDs, and trip duration (in seconds)
    chickpotle = results[0];
    console.log(chickpotle);
  })

</script>

</head>
<body>
</body>
</html>
